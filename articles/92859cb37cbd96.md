---
title: "git pullしたらWarningが！？"
emoji: "⚠️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["git", "github"]
published: false
---

``git pull``をした時、何度か遭遇したけど何とな〜く理解して、とりあえず``stash``して回避してたWarningがあります。
それについて、いい加減一度ちゃんと向き合わなければ...！と思ったので、今回ご紹介したいと思います！

## どんなWarningが出てくるの？
以下のような画像のWarningが出てくることがあります。
今回は、このWarningについて考えてみたいと思います。

![](https://storage.googleapis.com/zenn-user-upload/6525a500fe22-20231126.png)

## どんなときに出てくるのか？
以下のような状況で、このWarningが出てきます。

1. ``develop``ブランチから``feature/sample_A``ブランチを切る。
2. ``develop``ブランチで変更を加えてコミット。まだpushはしていない。
3. ``feature/sample_A``ブランチで変更を加え、コミット・push。
4. ``feature/sample_A``ブランチを分岐元である``develop``ブランチにマージする。
5. ローカルの``develop``ブランチを最新状態にするため、``git pull``する。（リモートブランチの状態を反映する。）

すると、先ほどのようなWarningが出てきます。
``git pull``したときに出てきました。

変更の状態はこんな感じです。
![](https://storage.googleapis.com/zenn-user-upload/49deb8742249-20231126.png)
左下あたりの赤丸部分を見てみると、リモートブランチからpullしてくる変更が2件、リモートブランチにpushする変更が1件あることがわかります。

## Warningを読んでみよう！
それでは、このWarningを解消する方法を探るため、Warningメッセージを解読していきます。

何やら、黄色い文字でメッセージが書かれています。
**hint**と書かれていますし、何か教えてくれているっぽいですね。
``` sh
hint: You have divergent branches and need to specify how to reconcile them.
hint: You can do so by running one of the following commands sometime before
hint: your next pull:
hint: 
hint:   git config pull.rebase false  # merge
hint:   git config pull.rebase true   # rebase
hint:   git config pull.ff only       # fast-forward only
hint: 
hint: You can replace "git config" with "git config --global" to set a default
hint: preference for all repositories. You can also pass --rebase, --no-rebase,
hint: or --ff-only on the command line to override the configured default per
hint: invocation.
fatal: Need to specify how to reconcile divergent branches.
```

少しずつ解読していきます。

### まずは1行目から。
まずは1行目を解読していきます。
``` sh
hint: You have divergent branches and need to specify how to reconcile them.
```
あまり聞き慣れない単語があったりしますね。私も最初検索かけるまで知らなかった単語があります。
一旦、ポイントになる単語それぞれの意味を考えます。

``divergent``・・・「不一致の、異なる」などといった意味があります。
``specify``・・・「特定する、指定する」といった意味があります。
``reconcile``・・・「調整する、一致させる」といった意味を持ちます。

つまり、おおよそ「不一致な、(状態が)異なるブランチがあるので、それらを調整する方法を指定する必要がある」と言われていることが見当つくと思います。

#### 不一致な、異なるブランチってどういうこと？
「不一致な、異なるブランチがある」と言われている理由はなぜなのでしょうか？

まず、何と何を比較して「不一致だ、異なる」と言っているのか考えてみましょう。
これは、``git pull``でリモートブランチの変更を取り込む際に起こっていることから、「**リモートブランチ**」と「**ローカルブランチ**」を比較しています。

``git pull``は、リモートブランチの状態を``fetch``して（取得して）きて、ローカルブランチへのマージ（反映）を行うコマンドです。
つまり、リモートブランチから変更を取り込もうとpullしてみたけど、ローカルでリモートに反映されていない変更が加えられているので、どう対応するのかを指定する必要があるのです。``git pull``自体は、コンフリクトや差分を解消するところまではやってくれません。

### 2〜3行目を解読してみる。
次に、2〜3行目です。
``` sh
hint: You can do so by running one of the following commands sometime before
hint: your next pull:
```

1行目で、リモートブランチとローカルブランチの差分を調整する方法を指定するように言われていることがわかりました。
2〜3行目では、その方法をどうやって指定したらよいのか、教えてくれています。
ざっくり、以下のようなことを言っています。
「次回pullする前に、次のコマンドのうちどれか1つを実行することで(差分を解決する方法を指定することが)できます。

### 「次のコマンド」って何？
じゃあ、「次のコマンド」って何？ってなると思います。
それが、5〜7行目の3つのコマンドのことを指します。
3つとも、``git config``で設定するコマンドです。

``` sh
hint:   git config pull.rebase false  # merge
hint:   git config pull.rebase true   # rebase
hint:   git config pull.ff only       # fast-forward only
```

それぞれがどういう方法なのか、簡単に説明します。

#### 1. merge
まずは1つ目、``merge``です。
``` sh
git config pull.rebase false  # merge
```
これは、``git pull``してくるときに、``rebase``せずに``merge``を行うものです。
``rebase``が``false``と指定されていることから、``rebase``しないことがわかります。

通常の``merge``と同じ動きをするもので、現在のブランチが何も変わっていなければ``fast-forward``を行い、それ以外の場合は、``merge commit``を作成してマージします。

``fast-forward``とは、現在のブランチの先頭が、マージしてくるブランチの先頭に移動するだけのマージです。現在のブランチとマージしてくるブランチの違いとしては、「**マージしてくるブランチで変更を加えた部分**」のみです。

また、``merge commit``を作成してマージするのは、現在のブランチ・マージしてくるブランチの両方で変更が進んでいる場合です。このような場合には、2つのブランチをまとめる必要があるので、それぞれの変更を取り込んだ``merge commit``が作成され、そのコミットが現在のブランチの先頭になります。

``merge``は、デフォルトの動作です。

#### 2. rebase
2つ目、``rebase``です。
``` sh
git config pull.rebase true   # rebase
```
こちらは、先ほどと違って、``rebase``が``true``と指定されています。マージではなく、``rebase``を行う方法です。
この``rebase``は、現在のブランチの変更を元のブランチの変更の後につなげて、現在のブランチの変更を元のブランチで適用します。必要があれば、コンフリクト解消を行います。
``rebase``だけだと、現在のブランチの変更を適用するだけなので、先ほど出てきた``fast-forward``で、元のブランチの先頭を``rebase``後の先頭コミットに移動する必要があります。

#### 3. fast-forward only
最後、3つ目。``fast-forward only``です。
``` sh
git config pull.ff only       # fast-forward only
```
この方法は、``fast-forward``ができる場合のみ実行し、できない場合はエラーを返して終了します。
現在のブランチとマージしてくるブランチでそれぞれ変更が進んでいる場合は、``fast-forward``できない場合にあたります。

これで、「状態が異なるブランチを調整する方法」がわかり、これら3つのうちどれかを設定すれば良いことがわかりました。

### 9〜12行目
ここまでで、このWarningを解消するために何をすれば良いと言ってくれているのか、わかってきました。
9〜12行目は一気に解読します。
``` sh
hint: You can replace "git config" with "git config --global" to set a default
hint: preference for all repositories. You can also pass --rebase, --no-rebase,
hint: or --ff-only on the command line to override the configured default per
hint: invocation.
```

先ほど、3つのコマンドが出てきましたが、それらは、``git config``でこのリポジトリで使うgitの設定を指定するものでした。でも、全てのリポジトリで同じ設定にしたいかもしれません。そういう場合には、``git config``のところを``git config --global``に置き換えて実行しましょうと教えてくれています。
また、``--rebase``や``--no-rebase``、``--ff-only``を指定して実行することで、設定を無効にして、指定した方法で実行することもできるとのことです。

### 最後の1行
ついにやってきました、最後の1行！
``` sh
fatal: Need to specify how to reconcile divergent branches.
```
ここまで読んできた皆さんにはもうわかると思いますが、最初の1行目に書かれていたものと同じ内容の文章です。

細かくメッセージを解読していったので、ここまで時間がかかってしまいました。
解読お疲れ様です！

## 早速解消していく！
それでは、メッセージの解読ができたので、Warning解消までやっていきましょう。

メッセージにおいて、3つの選択肢が用意されていました。
``merge``・``rebase``・``fast-forward``の3つでした。

チームの中で統一しているものがあればそれに合わせる必要がありますし、何もないのであれば、デフォルト動作の``merge``を選んでおくのが良いのかなと思っています。

ちなみに、もし``git config``で設定したくないという場合には、ローカルからpushしようとしている変更を``git stash -u``で一旦退避してローカルを元の状態に戻し、先に``git pull``を実行してから退避から戻すようにすれば対応できます。

## おまけ〜なんでこんなWarningが出るの？〜
このWarningが出るようになったのは、Gitの``v2.27.0``からです。
``rebase``や``fast-forword``しようとしていたユーザがデフォルトの``merge``が実行されてしまったことで、不要なコミットが作られてしまうことがあるためのようです。

## おわりに
お読みくださり、ありがとうございます！

## 参考資料
[サル先生のGit入門 ブランチの統合](https://backlog.com/ja/git-tutorial/stepup/04/)
[サル先生のGit入門 7. rebaseでマージする](https://backlog.com/ja/git-tutorial/stepup/13/)
[サル先生のGit入門 pull](https://backlog.com/ja/git-tutorial/stepup/14/)
[Git 2.27.0 から git pull をすると表示されるようになった "Pulling without specifying how to reconcile divergent branches is discouraged." について](https://blog.agile.esm.co.jp/entry/git-warns-pulling-without-specifying-how-to-reconcile-divergent-branches)
[git pullするとhintがたくさん出てくる](https://qiita.com/Bjp8kHYYPFq8MrI/items/77f7dfb9c078a3074b7b)
[pull: warn if the user didn't say whether to rebase or to merge](https://github.com/git/git/commit/d18c950a69f3a24e1e3add3d9fc427641f53e12b)
[git git-pull](https://git-scm.com/docs/git-pull)
[git git-merge](https://git-scm.com/docs/git-merge)
[git git-rebase](https://git-scm.com/docs/git-rebase)